<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
setInterval(function() {
    $.ajax({
        type: "GET",
        url: "{% url 'GUI:update' %}"
    })
    .done(function(response) {
        var htmlObject = document.createElement('div');
        htmlObject.innerHTML = response
        var jqueryObject = $(htmlObject);

        //update state Table
        $('#stateTable').html(jqueryObject.find("#table").html());

        //update log
        logs = jqueryObject.find("#log").html()
        //don't append empty rows
        if (logs.length>0)
          $('#log').append(logs);
          //allways scroll directly to bottom
          var textarea = document.getElementById('log');
          textarea.scrollTop = textarea.scrollHeight;
    });
    /*
    $.ajax({
        type: "GET",
        url: "{% url 'GUI:logs' %}"
    })
    .done(function(response) {
        if (response.length>1)
          $('#log').append(response);
          //allways scroll directly to bottom
          var textarea = document.getElementById('log');
          textarea.scrollTop = textarea.scrollHeight;
    });
    */
}, 6000)

$(document).ready(function() {
    $("#ready").click(function(e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "{% url 'GUI:ready' %}",
            data:{csrfmiddlewaretoken: '{{ csrf_token }}'},
            /*"success": function(result) {
                console.log(result);
            },*/
        });
    });
    $("#start").click(function(e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "{% url 'GUI:start' %}",
            data:{csrfmiddlewaretoken: '{{ csrf_token }}'},
        });
    });
    $("#stop").click(function(e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "{% url 'GUI:stop' %}",
            data:{csrfmiddlewaretoken: '{{ csrf_token }}'},
        });
    });
    $("#shutdown").click(function(e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "{% url 'GUI:shutdown' %}",
            data:{csrfmiddlewaretoken: '{{ csrf_token }}'},
        });
    });
});
</script>
</head>

<body>

<h1>PCA Overview</h1>

<div id="stateTable">
  <table>
    <tr>
      <th>Detector</th>
      <th>Status</th>
    </tr>
    {% for state in stateMap.items %}
    <tr>
        <td>
          {% if state.0 == 0%}
            Global State
          {%else%}
            {{state.0}}
          {% endif %}
        </td>
        <td>{{state.1.1}}</td>
    </tr>
    {% endfor %}
  </table>
</div>
<div visibility:{{PCAConnection}}>
  <button id="ready">ready</button>
  <button id="start">start</button>
  <button id="stop">stop</button>
  <button id="shutdown">shutdown</button>
</div>
<textarea readonly id="log"></textarea>
{%if error%}
<p visibility:={{error}}>Error</p>
{%endif%}
</body>
</html>
